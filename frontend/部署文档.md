# ETH批量转账系统 - 前端部署文档

## 项目概述

**项目名称**: ETH批量转账系统前端应用  
**技术栈**: React 18 + TypeScript + Vite + Ant Design + Web3  
**版本**: 1.0.0  
**Node.js要求**: >=18.0.0  
**npm要求**: >=9.0.0

## 🏗️ 技术架构

### 核心技术栈
- **前端框架**: React 18.2.0 + TypeScript 5.2.2
- **构建工具**: Vite 5.0.0
- **UI组件库**: Ant Design 5.12.8 + Ant Design Pro Components
- **样式方案**: Tailwind CSS + WindiCSS
- **Web3集成**: Wagmi 2.16.0 + ethers.js 6.8.1 + RainbowKit
- **状态管理**: Zustand 4.4.7
- **路由**: React Router DOM 6.20.1
- **数据请求**: Axios + TanStack React Query
- **图表**: Recharts 2.8.0

### 项目结构
```
frontend/
├── src/
│   ├── components/          # 组件
│   │   └── layout/         # 布局组件
│   ├── pages/              # 页面
│   ├── hooks/              # 自定义Hook
│   ├── store/              # 状态管理
│   ├── constants/          # 常量配置
│   ├── providers/          # 上下文提供者
│   └── styles/             # 样式文件
├── public/                 # 静态资源
├── dist/                   # 构建输出
├── package.json           # 项目配置
├── vite.config.ts         # Vite配置
├── tsconfig.json          # TypeScript配置
└── index.html             # 入口HTML
```

## 🚀 快速开始

### 1. 环境准备

#### 系统要求
- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0 (或使用 yarn/pnpm)
- **Git**: 最新版本

#### 检查环境
```bash
# 检查Node.js版本
node --version

# 检查npm版本
npm --version

# 检查Git版本
git --version
```

### 2. 项目安装

#### 克隆项目
```bash
git clone https://github.com/webthree/batch-transfer.git
cd batch-transfer/frontend
```

#### 安装依赖
```bash
# 使用npm
npm install

# 或使用yarn
yarn install

# 或使用pnpm
pnpm install
```

### 3. 开发环境运行

#### 启动开发服务器
```bash
npm run dev
```

服务器将在 `http://localhost:3000` 启动，支持：
- 🔥 热模块重载 (HMR)
- 🔍 ESLint实时检查
- 🎯 API代理到后端 (localhost:8080)
- 📱 移动端调试支持

#### 其他开发命令
```bash
# 类型检查
npm run type-check

# 代码格式检查
npm run format:check

# 代码格式修复
npm run format

# ESLint检查
npm run lint

# ESLint修复
npm run lint:fix

# 运行测试
npm run test

# 测试覆盖率
npm run test:coverage

# 测试UI界面
npm run test:ui
```

## 📦 生产构建

### 1. 构建项目

```bash
# 生产构建
npm run build
```

构建过程包括：
- ✅ TypeScript类型检查
- 📦 代码打包和压缩
- 🎯 自动代码分割
- 🗜️ 资源优化
- 📊 生成构建分析报告

### 2. 构建输出

构建完成后，产物位于 `dist/` 目录：

```
dist/
├── index.html              # 入口HTML文件
├── js/                     # JavaScript文件
│   ├── main-[hash].js     # 主入口文件
│   ├── react-vendor-[hash].js    # React相关库
│   ├── ui-vendor-[hash].js       # UI组件库
│   ├── web3-vendor-[hash].js     # Web3相关库
│   └── utils-vendor-[hash].js    # 工具库
├── css/                    # CSS样式文件
├── images/                 # 图片资源
├── fonts/                  # 字体文件
└── stats.html             # 打包分析报告
```

### 3. 构建分析

查看打包分析报告：
```bash
npm run analyze
```

或直接打开 `dist/stats.html` 文件。

### 4. 本地预览

```bash
npm run preview
```

在 `http://localhost:3000` 预览生产构建版本。

## 🌐 部署指南

### 1. 静态文件部署

#### Nginx部署

**nginx.conf 配置示例：**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/batch-transfer;
    index index.html;

    # 启用gzip压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # HTML文件不缓存
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # React Router支持
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API代理到后端
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket支持
    location /ws {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

**部署步骤：**
```bash
# 1. 构建项目
npm run build

# 2. 上传构建文件
scp -r dist/* user@your-server:/var/www/batch-transfer/

# 3. 重启Nginx
sudo systemctl reload nginx
```

#### Apache部署

**.htaccess 配置：**
```apache
RewriteEngine On

# React Router支持
RewriteBase /
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]

# 静态资源缓存
<filesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 year"
    Header append Cache-Control "public"
</filesMatch>

# HTML文件不缓存
<filesMatch "\.html$">
    ExpiresActive On
    ExpiresDefault "access plus 0 seconds"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
</filesMatch>

# 启用压缩
<ifModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</ifModule>
```

### 2. CDN部署

#### 阿里云OSS + CDN

```bash
# 安装阿里云CLI工具
npm install -g @alicloud/cli

# 配置访问密钥
aliyun configure

# 上传到OSS
aliyun oss cp -r dist/ oss://your-bucket/batch-transfer/ --include "*"

# 刷新CDN缓存
aliyun cdn refresh-object-caches --object-path https://your-cdn-domain.com/
```

#### 腾讯云COS + CDN

```bash
# 安装腾讯云CLI工具
npm install -g qcloud-cli

# 配置密钥
qcloud configure

# 上传文件
coscmd upload -r dist/ /batch-transfer/

# 刷新CDN
coscmd cdn purge https://your-cdn-domain.com/
```

### 3. Docker部署

#### Dockerfile
```dockerfile
# 构建阶段
FROM node:18-alpine as builder

WORKDIR /app

# 复制package文件
COPY package*.json ./

# 安装依赖
RUN npm ci --only=production

# 复制源代码
COPY . .

# 构建应用
RUN npm run build

# 生产阶段
FROM nginx:alpine

# 复制构建文件
COPY --from=builder /app/dist /usr/share/nginx/html

# 复制nginx配置
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 暴露端口
EXPOSE 80

# 启动nginx
CMD ["nginx", "-g", "daemon off;"]
```

#### docker-compose.yml
```yaml
version: '3.8'

services:
  frontend:
    build: .
    ports:
      - "80:80"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    depends_on:
      - backend

  backend:
    image: your-backend-image
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
```

#### 部署命令
```bash
# 构建镜像
docker build -t batch-transfer-frontend .

# 运行容器
docker run -d -p 80:80 --name frontend batch-transfer-frontend

# 或使用docker-compose
docker-compose up -d
```

### 4. Vercel部署

#### vercel.json配置
```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "https://your-backend-api.com/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ],
  "headers": [
    {
      "source": "/(.*)\\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

#### 部署步骤
```bash
# 安装Vercel CLI
npm install -g vercel

# 登录Vercel
vercel login

# 部署
vercel --prod
```

### 5. Netlify部署

#### netlify.toml配置
```toml
[build]
  publish = "dist"
  command = "npm run build"

[[redirects]]
  from = "/api/*"
  to = "https://your-backend-api.com/api/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
```

## ⚙️ 环境配置

### 1. 环境变量

创建 `.env` 文件（开发环境）：
```bash
# API配置
VITE_API_BASE_URL=http://localhost:8080/api
VITE_WS_BASE_URL=ws://localhost:8080/ws

# Web3配置
VITE_CHAIN_ID=1
VITE_RPC_URL=https://mainnet.infura.io/v3/your-project-id

# 功能开关
VITE_ENABLE_ANALYTICS=false
VITE_ENABLE_DEBUG=true

# 版本信息
VITE_APP_VERSION=1.0.0
```

创建 `.env.production` 文件（生产环境）：
```bash
# API配置
VITE_API_BASE_URL=https://api.your-domain.com/api
VITE_WS_BASE_URL=wss://api.your-domain.com/ws

# Web3配置
VITE_CHAIN_ID=1
VITE_RPC_URL=https://mainnet.infura.io/v3/your-project-id

# 功能开关
VITE_ENABLE_ANALYTICS=true
VITE_ENABLE_DEBUG=false

# 版本信息
VITE_APP_VERSION=1.0.0
```

### 2. 代理配置

vite.config.ts中的代理配置：
```typescript
server: {
  proxy: {
    '/api': {
      target: process.env.VITE_API_BASE_URL || 'http://localhost:8080',
      changeOrigin: true,
      secure: false,
    },
    '/ws': {
      target: process.env.VITE_WS_BASE_URL || 'ws://localhost:8080',
      ws: true,
      changeOrigin: true,
    },
  },
}
```

## 🔧 故障排除

### 常见问题

#### 1. 依赖安装失败
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

#### 2. 构建内存不足
```bash
# 增加Node.js内存限制
export NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

#### 3. 路由404问题
确保服务器配置了React Router的回退路由：
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

#### 4. Web3连接问题
检查网络配置和RPC端点：
```typescript
// 在开发者工具控制台检查
console.log('Current Chain ID:', window.ethereum?.chainId)
console.log('RPC URL:', process.env.VITE_RPC_URL)
```

#### 5. API请求跨域
确保后端配置了CORS或使用代理：
```bash
# 检查代理配置
curl -I http://localhost:3000/api/health
```

### 性能优化

#### 1. 打包分析
```bash
npm run analyze
```

查看打包报告，优化大体积依赖。

#### 2. 代码分割
使用React.lazy进行组件懒加载：
```typescript
const Dashboard = React.lazy(() => import('./pages/Dashboard'))
```

#### 3. 缓存策略
- 静态资源：长期缓存 (1年)
- HTML文件：不缓存
- API数据：适当缓存

#### 4. CDN优化
- 使用CDN加速静态资源
- 启用gzip/brotli压缩
- 图片使用WebP格式

## 📊 监控与维护

### 1. 错误监控

集成Sentry错误监控：
```bash
npm install @sentry/react
```

### 2. 性能监控

使用Web Vitals监控性能：
```bash
npm install web-vitals
```

### 3. 日志收集

配置前端日志收集：
```typescript
// 生产环境日志收集
if (import.meta.env.PROD) {
  // 收集错误日志
  window.addEventListener('error', (event) => {
    // 发送到日志服务
  })
}
```

### 4. 自动化部署

GitHub Actions配置：
```yaml
name: Deploy Frontend

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm test
    
    - name: Build
      run: npm run build
    
    - name: Deploy
      # 部署到服务器
      run: |
        # 部署脚本
```

## 📚 附录

### 浏览器支持

- Chrome >= 88
- Firefox >= 78
- Safari >= 14
- Edge >= 88

### 相关链接

- [Vite官方文档](https://vitejs.dev/)
- [React官方文档](https://react.dev/)
- [Ant Design文档](https://ant.design/)
- [Wagmi文档](https://wagmi.sh/)
- [项目GitHub仓库](https://github.com/webthree/batch-transfer)

### 技术支持

如有问题，请联系：
- 邮箱: support@webthree.com
- GitHub Issues: https://github.com/webthree/batch-transfer/issues

---

**最后更新**: 2024年1月
**文档版本**: 1.0.0