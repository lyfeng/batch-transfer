# Batch Transfer DApp V2 产品文档

## 1. 简介

本文档描述了批量转账 DApp V2 的核心功能和需求。V2 版本在原有 ETH 批量转账的基础上，增加了 ERC20 代币支持、手续费机制和可升级合约，旨在提供一个功能更全面、可扩展性更强的批量转账工具。

## 2. 核心功能变更

### 2.1. ERC20 代币批量转账

*   **FR-201:** 用户可以选择转账 ETH 或指定的 ERC20 代币。
*   **FR-202:** 用户在导入转账列表（CSV 或手动输入）时，需指定代币合约地址（如果选择转账 ERC20）。
*   **FR-203:** 系统需验证用户拥有足够的 ERC20 代币余额，并已授权给批量转账合约相应的 `allowance`。

### 2.2. 手续费机制

*   **FR-204:** 智能合约将在每笔批量转账交易中，按总转账金额的一定比例收取手续费。
*   **FR-205:** 手续费比例由合约所有者设定，并可更新。
*   **FR-206:** 前端界面应清晰展示预估的手续费金额。

### 2.3. 可升级的智能合约

*   **NFR-201:** 智能合约采用可升级模式（例如 UUPS 或 Transparent Proxy），允许在不影响用户数据和现有功能的情况下，对合约逻辑进行迭代和修复。
*   **NFR-202:** 合约的升级权限由一个或多个指定地址控制（例如多签钱包）。

## 3. 功能需求

| 模块 | 功能点 | 描述 |
| :--- | :--- | :--- |
| **转账任务创建** | **FR-001 (扩展)** | 支持导入 ETH 或 ERC20 代币的转账列表 (CSV/手动)。 |
| | **FR-003 (扩展)** | 概览信息需包含代币类型和总手续费。 |
| | **FR-005 (扩展)** | 余额检查需同时考虑 ETH/ERC20 余额、Gas 费和平台手续费。 |
| **智能合约** | **FR-010 (扩展)** | 提供新的合约接口，例如 `batchTransferToken(address _token, address[] _recipients, uint256[] _amounts)`。 |
| | **FR-204** | 实现手续费收取逻辑。 |
| | **NFR-201** | 实现为可升级合约。 |
| **任务管理** | **FR-007 (扩展)** | 任务列表和详情页需标明转账类型（ETH/ERC20）。 |

## 4. 非功能需求

| 类别 | 需求点 | 描述 |
| :--- | :--- | :--- |
| **安全性** | **NFR-006 (扩展)** | 可升级合约的升级机制必须经过严格审计。 |
| **兼容性** | **NFR-014** | 智能合约保持 EVM 兼容性。 |