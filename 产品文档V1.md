## ETH 批量转账功能 MVP 需求文档

### 1\. 简介

本文档描述了 ETH 批量转账功能 MVP（最小可行产品）的需求。该功能旨在提供一个用户友好的界面，允许用户创建、管理和执行批量 ETH 转账任务，并通过部署在以太坊区块链上的智能合约实现高效、安全的链上批量交易。该 MVP 将专注于核心功能，为未来扩展奠定坚实基础。

### 2\. 目标

  * **提升效率：** 允许用户一次性向多个地址进行 ETH 转账，显著减少重复操作。
  * **确保安全：** 利用智能合约保证批量转账的原子性和透明性，降低人为错误风险。
  * **用户友好：** 提供直观的界面，简化批量转账任务的创建和管理流程。
  * **快速验证：** 以最小可行产品形式快速上线，收集用户反馈并验证核心业务价值。

### 3\. 用户角色

  * **普通用户：** 需要进行批量 ETH 转账的个人或组织，通常持有一定数量的 ETH，并希望高效地分发给多个接收方。

### 4\. 功能需求

#### 4.1. 批量转账任务创建与导入

  * **FR-001：** 用户应能通过上传 CSV来导入转账列表。
      * **文件格式：**
          * **CSV：** 每行包含 `接收地址 (字符串),金额 (ETH，浮点数)`。示例：`0xabc...,1.23`
      * **验证：** 系统应在导入时对文件内容进行严格校验，确保：
          * 所有接收地址为有效的以太坊地址格式。
          * 金额为大于零的有效数字。
          * 文件大小和转账条目数在合理范围内（例如，MVP 阶段限制单次转账条目不超过 200 条）。
  * **FR-002：** 用户应能手动输入或粘贴转账列表。
      * **格式：** 每行 `接收地址,金额 (ETH)`。系统应提供一个文本区域供用户输入，并实时进行格式校验。
  * **FR-003：** 系统应在用户导入/输入转账列表后，显示一个概览信息，包括：
      * **总转账笔数。**
      * **总转账金额 (ETH)。**
      * **列表有效性提示**（例如：成功导入 X 条，跳过 Y 条无效数据）。
  * **FR-004：** 用户应能为批量转账任务指定一个易于识别的**任务名称**。
  * **FR-005：** 在用户确认创建任务前，系统应提示用户核对总转账金额和所需的 Gas 费用（预估值），并确保其连接钱包中的 ETH 余额充足以支付所有转账和 Gas 费用。

#### 4.2. 批量转账任务管理与执行

  * **FR-006：** 系统应提供一个清晰的任务列表界面，展示所有已创建的批量转账任务。
  * **FR-007：** 每个任务应显示以下关键信息：
      * **任务名称。**
      * **创建时间。**
      * **总转账笔数。**
      * **总转账金额 (ETH)。**
      * **当前状态：**
          * **待执行 (Pending)：** 任务已创建但尚未触发执行。
          * **执行中 (Executing)：** 交易已发送到区块链，正在等待确认。
          * **已完成 (Completed)：** 智能合约交易已成功上链，所有子转账已执行。
          * **部分完成 (Partially Completed)：** （可选，如果智能合约支持部分成功，MVP 阶段可忽略）
          * **失败 (Failed)：** 智能合约交易失败或被拒绝。
  * **FR-008：** 用户应能点击任务名称，查看单个批量转账任务的详细信息，包括：
      * 每笔子转账的**接收地址**和**金额**。
      * 如果已执行，显示**交易哈希 (Transaction Hash)**。
      * 每笔子转账的执行结果（例如：成功/失败，如果智能合约能返回详细状态）。
  * **FR-009：** 用户应能选择“待执行”状态的任务，并触发其执行。
      * 触发执行时，前端应与用户连接的 Web3 钱包（如 MetaMask）交互，发起智能合约调用。

#### 4.3. 批量转账执行 (智能合约交互)

  * **FR-010：** 当用户触发任务执行时，前端应用应通过其连接的 Web3 钱包，调用预部署在以太坊区块链上的**批量转账智能合约**。
      * **智能合约接口：** 合约应暴露一个公共函数，例如 `batchTransfer(address[] _recipients, uint256[] _amounts)`，其中金额单位为 Wei。
      * **Gas 费用估算：** 在发起交易前，前端应利用 Web3 库估算交易所需的 Gas Limit 和 Gas Price，并向用户展示预估费用。
  * **FR-011：** 系统应在交易成功发送到区块链后，立即捕获并记录该**交易哈希 (Transaction Hash)**。
  * **FR-012：** 后端服务应通过监听区块链事件或定时查询交易状态，根据交易哈希异步更新批量转账任务的状态：
      * `待执行` → `执行中`：交易已发送到区块链。
      * `执行中` → `已完成`：交易成功上链，智能合约执行成功。
      * `执行中` → `失败`：交易失败（例如：Gas 不足、合约执行错误、被拒绝等）。
  * **FR-013：** 如果智能合约调用失败，系统应在任务详情中提供错误信息（例如：区块链返回的错误消息）。

#### 4.4. 查询与历史记录

  * **FR-014：** 用户应能查询所有已完成或失败的批量转账任务的历史记录。
  * **FR-015：** 每个历史任务应能查看其详细信息，包括每笔子转账的最终状态（成功/失败），以及对应的区块链交易哈希。

### 5\. 非功能需求

#### 5.1. 性能

  * **NFR-001：** 批量转账智能合约应优化 Gas 消耗，以降低用户转账成本。
  * **NFR-002：** 用户界面的加载和操作响应时间应在 2 秒以内。
  * **NFR-003：** 后端服务应能支持并发处理至少 50 个批量转账任务。

#### 5.2. 安全性

  * **NFR-004：** 用户私钥不应在任何服务器端存储或处理，所有交易签名必须在客户端（如 MetaMask）完成。
  * **NFR-005：** 前后端通信应全程使用 HTTPS 加密。
  * **NFR-006：** 智能合约代码必须经过严格测试，并在生产环境部署前进行独立安全审计。
  * **NFR-007：** 后端服务应采取适当的措施防止 SQL 注入、XSS 等常见 Web 漏洞。

#### 5.3. 可用性

  * **NFR-008：** 界面应简洁直观，用户无需专业区块链知识也能顺利操作。
  * **NFR-009：** 提供清晰、友好的错误消息和操作提示，引导用户解决问题。
  * **NFR-010：** 支持主流浏览器（Chrome, Firefox, Edge, Safari 的最新版本）。

#### 5.4. 可靠性

  * **NFR-011：** 后端服务应具有高可用性，保证任务状态的准确性和及时更新。
  * **NFR-012：** 数据库应定期备份，以防数据丢失。

#### 5.5. 兼容性

  * **NFR-013：** 前端应用应与主流的以太坊浏览器钱包（如 MetaMask、Trust Wallet 等）兼容。
  * **NFR-014：** 智能合约应兼容 EVM 兼容链，以便未来扩展。