-- 批量转账系统测试数据脚本
-- 用于开发和测试环境

USE batch_transfer;


-- 插入测试任务数据
INSERT INTO batch_transfer_task (
    id, task_name, recipient_count, total_amount, status, tx_hash, error_message, creator_address, created_at, updated_at
) VALUES 
-- 已完成的任务
(1, '测试批量转账-1', 3, 0.150000000000000000, 'COMPLETED', 
 '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef', 
 NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-15 10:00:00', '2024-01-15 10:05:00'),

(2, '工资发放-2024年1月', 5, 2.500000000000000000, 'COMPLETED', 
 '0x2345678901bcdef12345678901bcdef12345678901bcdef12345678901bcdef1', 
 NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-16 14:30:00', '2024-01-16 14:35:00'),

(3, '奖金发放-Q4', 2, 1.000000000000000000, 'COMPLETED', 
 '0x3456789012cdef123456789012cdef123456789012cdef123456789012cdef12', 
 NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-17 09:15:00', '2024-01-17 09:20:00'),

-- 执行中的任务
(4, '月度分红发放', 4, 3.200000000000000000, 'EXECUTING', 
 '0x4567890123def1234567890123def1234567890123def1234567890123def123', 
 NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-18 16:45:00', '2024-01-18 16:50:00'),

-- 待执行的任务
(5, '团队激励发放', 6, 1.800000000000000000, 'PENDING', 
 NULL, NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-19 11:20:00', '2024-01-19 11:20:00'),

(6, '项目奖励发放', 3, 0.900000000000000000, 'PENDING', 
 NULL, NULL, '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-19 15:30:00', '2024-01-19 15:30:00'),

-- 失败的任务
(7, '测试失败任务', 2, 0.200000000000000000, 'FAILED', 
 NULL, 'Gas estimation failed: insufficient funds', 
 '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-18 08:00:00', '2024-01-18 08:05:00'),

(8, '大额转账测试', 10, 50.000000000000000000, 'FAILED', 
 NULL, 'Transaction reverted: exceeds maximum transfer limit', 
 '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-17 20:00:00', '2024-01-17 20:10:00');

-- 插入测试转账项数据
INSERT INTO batch_transfer_item (
    task_id, recipient_address, amount, status, created_at
) VALUES 
-- 任务1的转账项（已完成）
(1, '0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b1', 0.050000000000000000, 'SUCCESS', '2024-01-15 10:00:00'),
(1, '0x8ba1f109551bD432803012645Hac136c5C1b4d8b', 0.050000000000000000, 'SUCCESS', '2024-01-15 10:00:00'),
(1, '0x9Ac64Cc6634C0532925a3b8D4C9db96C4b4d8b2', 0.050000000000000000, 'SUCCESS', '2024-01-15 10:00:00'),

-- 任务2的转账项（已完成）
(2, '0xA1b2C3d4E5f6789012345678901234567890Ab1', 0.500000000000000000, 'SUCCESS', '2024-01-16 14:30:00'),
(2, '0xB2c3D4e5F6789012345678901234567890Bc2', 0.500000000000000000, 'SUCCESS', '2024-01-16 14:30:00'),
(2, '0xC3d4E5f6789012345678901234567890Cd3', 0.500000000000000000, 'SUCCESS', '2024-01-16 14:30:00'),
(2, '0xD4e5F6789012345678901234567890De4', 0.500000000000000000, 'SUCCESS', '2024-01-16 14:30:00'),
(2, '0xE5f6789012345678901234567890Ef5', 0.500000000000000000, 'SUCCESS', '2024-01-16 14:30:00'),

-- 任务3的转账项（已完成）
(3, '0xF6789012345678901234567890Fg6', 0.600000000000000000, 'SUCCESS', '2024-01-17 09:15:00'),
(3, '0x1234567890123456789012345678901234567890', 0.400000000000000000, 'SUCCESS', '2024-01-17 09:15:00'),

-- 任务4的转账项（执行中）
(4, '0x2345678901234567890123456789012345678901', 0.800000000000000000, 'PENDING', '2024-01-18 16:45:00'),
(4, '0x3456789012345678901234567890123456789012', 0.800000000000000000, 'PENDING', '2024-01-18 16:45:00'),
(4, '0x4567890123456789012345678901234567890123', 0.800000000000000000, 'PENDING', '2024-01-18 16:45:00'),
(4, '0x5678901234567890123456789012345678901234', 0.800000000000000000, 'PENDING', '2024-01-18 16:45:00'),

-- 任务5的转账项（待执行）
(5, '0x6789012345678901234567890123456789012345', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),
(5, '0x7890123456789012345678901234567890123456', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),
(5, '0x8901234567890123456789012345678901234567', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),
(5, '0x9012345678901234567890123456789012345678', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),
(5, '0xa123456789012345678901234567890123456789', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),
(5, '0xb234567890123456789012345678901234567890', 0.300000000000000000, 'PENDING', '2024-01-19 11:20:00'),

-- 任务6的转账项（待执行）
(6, '0xc345678901234567890123456789012345678901', 0.300000000000000000, 'PENDING', '2024-01-19 15:30:00'),
(6, '0xd456789012345678901234567890123456789012', 0.300000000000000000, 'PENDING', '2024-01-19 15:30:00'),
(6, '0xe567890123456789012345678901234567890123', 0.300000000000000000, 'PENDING', '2024-01-19 15:30:00'),

-- 任务7的转账项（失败）
(7, '0xf678901234567890123456789012345678901234', 0.100000000000000000, 'FAILED', '2024-01-18 08:00:00'),
(7, '0x1789012345678901234567890123456789012345', 0.100000000000000000, 'FAILED', '2024-01-18 08:00:00'),

-- 任务8的转账项（失败）
(8, '0x2890123456789012345678901234567890123456', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x3901234567890123456789012345678901234567', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x4012345678901234567890123456789012345678', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x5123456789012345678901234567890123456789', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x6234567890123456789012345678901234567890', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x7345678901234567890123456789012345678901', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x8456789012345678901234567890123456789012', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0x9567890123456789012345678901234567890123', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0xa678901234567890123456789012345678901234', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00'),
(8, '0xb789012345678901234567890123456789012345', 5.000000000000000000, 'FAILED', '2024-01-17 20:00:00');

-- 创建一些额外的测试数据用于分页和搜索测试
INSERT INTO batch_transfer_task (
    task_name, recipient_count, total_amount, status, creator_address, created_at, updated_at
) VALUES 
('批量转账测试-9', 1, 0.100000000000000000, 'COMPLETED', '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-10 10:00:00', '2024-01-10 10:05:00'),
('批量转账测试-10', 1, 0.200000000000000000, 'COMPLETED', '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-11 11:00:00', '2024-01-11 11:05:00'),
('批量转账测试-11', 1, 0.300000000000000000, 'COMPLETED', '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-12 12:00:00', '2024-01-12 12:05:00'),
('批量转账测试-12', 1, 0.400000000000000000, 'PENDING', '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-13 13:00:00', '2024-01-13 13:00:00'),
('批量转账测试-13', 1, 0.500000000000000000, 'PENDING', '0xD12dEb819Ee1A864029B1814Fb93D1E956592154', '2024-01-14 14:00:00', '2024-01-14 14:00:00');

-- 为新创建的任务添加转账项
INSERT INTO batch_transfer_item (task_id, recipient_address, amount, status, created_at)
SELECT 
    t.id,
    CONCAT('0x', LPAD(HEX(t.id * 1000 + 1), 40, '0')),
    t.total_amount,
    CASE WHEN t.status = 'COMPLETED' THEN 'SUCCESS' ELSE 'PENDING' END,
    t.created_at
FROM batch_transfer_task t 
WHERE t.id > 8;

-- 验证数据完整性
SELECT 
    '任务统计' as category,
    COUNT(*) as total_count,
    COUNT(CASE WHEN status = 'PENDING' THEN 1 END) as pending,
    COUNT(CASE WHEN status = 'EXECUTING' THEN 1 END) as executing,
    COUNT(CASE WHEN status = 'COMPLETED' THEN 1 END) as completed,
    COUNT(CASE WHEN status = 'FAILED' THEN 1 END) as failed
FROM batch_transfer_task

UNION ALL

SELECT 
    '转账项统计' as category,
    COUNT(*) as total_count,
    COUNT(CASE WHEN status = 'PENDING' THEN 1 END) as pending,
    0 as executing,
    COUNT(CASE WHEN status = 'SUCCESS' THEN 1 END) as completed,
    COUNT(CASE WHEN status = 'FAILED' THEN 1 END) as failed
FROM batch_transfer_item;

-- 显示测试数据摘要
SELECT 
    'Test data created successfully!' as message,
    (SELECT COUNT(*) FROM batch_transfer_task) as total_tasks,
    (SELECT COUNT(*) FROM batch_transfer_item) as total_items;

-- 显示任务状态分布
SELECT 
    status,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM batch_transfer_task), 2) as percentage
FROM batch_transfer_task 
GROUP BY status 
ORDER BY count DESC;
